source: TankenTanken!
source_url: https://tankentanken.de/
description: |
  TankenTanken! is a service that provides information about gas stations in Germany, with data from the German Federal Cartel Office (Bundeskartellamt). It includes details about fuel prices, gas station locations, and other relevant information.
  The service is designed to help users find the best fuel prices and gas stations in their vicinity
databases:
  tankentanken:
    queries:
      my_stations:
        title: Meine Tankstellen
        hide_sql: true
        sql: |-
          WITH ranked AS (
            SELECT
              ph.*,
              ROW_NUMBER() OVER (
                PARTITION BY station_id
                ORDER BY
                  last_transmission DESC,
                  id DESC
              ) AS rn
            FROM
              price_history ph
            WHERE
              station_id IN (819, 765, 160, 755, 447, 54, 1033, 1035, 396)
          )
          SELECT
            g.name,
            r.price_super_e10,
            g.address,
            'https://tankentanken.de/tankstelle/' || g.station_id as link,
            g.latitude,
            g.longitude
          FROM
            ranked r
            join gas_stations g on r.station_id = g.id
          WHERE
            rn = 1
          order by
            r.price_super_e10 asc;
